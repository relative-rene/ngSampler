"use strict";(self.webpackChunkngSampler=self.webpackChunkngSampler||[]).push([[234],{2234:(b,g,c)=>{c.r(g),c.d(g,{OauthRoutes:()=>y});var t=c(5879);let _=(()=>{var o;class n{constructor(){this.message="HomeComponent constructor"}ngOnInit(){}}return(o=n).\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["forbidden"]],standalone:!0,features:[t.jDz],decls:2,vars:0,template:function(e,a){1&e&&(t.TgZ(0,"div"),t._uU(1,"Welcome"),t.qZA())},encapsulation:2}),n})(),A=(()=>{var o;class n{constructor(){}ngOnInit(){}}return(o=n).\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["authorized"]],standalone:!0,features:[t.jDz],decls:3,vars:0,template:function(e,a){1&e&&(t.TgZ(0,"div")(1,"h2"),t._uU(2,"Authorized"),t.qZA()())},encapsulation:2}),n})(),C=(()=>{var o;class n{constructor(){this.message="UnauthorizedComponent constructor"}ngOnInit(){}}return(o=n).\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["unauthorized"]],standalone:!0,features:[t.jDz],decls:2,vars:0,template:function(e,a){1&e&&(t.TgZ(0,"div"),t._uU(1,"401: You have no rights to access this. Please Login"),t.qZA())},encapsulation:2}),n})(),I=(()=>{var o;class n{constructor(){}ngOnInit(){}}return(o=n).\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["page-notfound"]],decls:1,vars:0,template:function(e,a){1&e&&t._uU(0,"page not found")},encapsulation:2}),n})();var h=c(5495),v=c(9862);let k=(()=>{var o;class n{constructor(){this.Server="https://localhost:44345",this.FileServer="https://localhost:44378"}}return(o=n).\u0275fac=function(e){return new(e||o)},o.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac}),n})(),m=(()=>{var o;class n{constructor(e,a,i){this._http=e,this._configuration=a,this._router=i,this.actionUrl=a.Server+"api/DataEventRecords/",this.headers=new v.WM,this.headers.append("Content-Type","application/json"),this.headers.append("Accept","application/json"),this.storage=localStorage,""!==this.retrieve("IsAuthorized")&&(this.HasAdminRole=this.retrieve("HasAdminRole"),this.IsAuthorized=this.retrieve("IsAuthorized"))}GetToken(){return this.retrieve("authorizationData")}ResetAuthorizationData(){this.store("authorizationData",""),this.store("authorizationDataIdToken",""),this.IsAuthorized=!1,this.HasAdminRole=!1,this.store("HasAdminRole",!1),this.store("IsAuthorized",!1)}SetAuthorizationData(e,a){""!==this.retrieve("authorizationData")&&this.store("authorizationData",""),this.store("authorizationData",e),this.store("authorizationDataIdToken",a),this.IsAuthorized=!0,this.store("IsAuthorized",!0),this.getDataFromToken(e)}Authorize(){this.ResetAuthorizationData(),console.log("BEGIN Authorize, no auth data");var u="N"+Math.random()+Date.now(),l=Date.now()+""+Math.random();this.store("authStateControl",l),this.store("authNonce",u),console.log("AuthorizedController created. adding myautostate: "+this.retrieve("authStateControl"));var p="https://localhost:44345/connect/authorize?response_type="+encodeURI("id_token token")+"&client_id="+encodeURI("js.ng2")+"&redirect_uri="+encodeURI("http://localhost:3000")+"&scope="+encodeURI("openid")+"&nonce="+encodeURI(u)+"&state="+encodeURI(l);window.location.href=p}AuthorizedCallback(){console.log("BEGIN AuthorizedCallback, no auth data"),this.ResetAuthorizationData();var a=window.location.hash.substr(1).split("&").reduce(function(l,p){var z=p.split("=");return l[z[0]]=z[1],l},{});console.log(a),console.log("AuthorizedCallback created, begin token validation");var i="",s="",d=!1;if(!a.error)if(a.state!==this.retrieve("authStateControl"))console.log("AuthorizedCallback incorrect state");else{i=a.access_token;var u=this.getDataFromToken(s=a.id_token);console.log(u),u.nonce!==this.retrieve("authNonce")?console.log("AuthorizedCallback incorrect nonce"):(this.store("authNonce",""),this.store("authStateControl",""),d=!0,console.log("AuthorizedCallback state and nonce validated, returning access token"))}d?(this.SetAuthorizationData(i,s),console.log(this.retrieve("authorizationData")),console.log("router befor:",this._router.url),this._router.navigate(["authorized"]),console.log("router after:",this._router.url)):(this.ResetAuthorizationData(),this._router.navigate(["/unauthorized"]))}Logoff(){console.log("BEGIN Authorize, no auth data");var a=this.retrieve("authorizationDataIdToken"),s="https://localhost:44345/connect/endsession?id_token_hint="+encodeURI(a)+"&post_logout_redirect_uri="+encodeURI("https://localhost:44311/Unauthorized.html");this.ResetAuthorizationData(),window.location.href=s}HandleError(e){console.log(e),403==e.status?this._router.navigate(["/Forbidden"]):401==e.status&&(this.ResetAuthorizationData(),this._router.navigate(["/Unauthorized"]))}urlBase64Decode(e){var a=e.replace("-","+").replace("_","/");switch(a.length%4){case 0:break;case 2:a+="==";break;case 3:a+="=";break;default:throw"Illegal base64url string!"}return window.atob(a)}getDataFromToken(e){var a={};if(typeof e<"u"){var i=e.split(".")[1];a=JSON.parse(this.urlBase64Decode(i))}return a}retrieve(e){var a=this.storage.getItem(e);if(a&&"undefined"!==a)return JSON.parse(this.storage.getItem(e))}store(e,a){this.storage.setItem(e,JSON.stringify(a))}}return(o=n).\u0275fac=function(e){return new(e||o)(t.LFG(v.eN),t.LFG(k),t.LFG(h.F0))},o.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac}),n})();var f=c(6814);function D(o,n){if(1&o){const r=t.EpF();t.TgZ(0,"a",12),t.NdJ("click",function(){t.CHM(r);const a=t.oxw();return t.KtG(a.Logout())}),t._uU(1,"Logout"),t.qZA()}}const y=[{path:"",component:(()=>{var o;class n{constructor(e,a){this.securityService=e,this._router=a}ngAfterViewInit(){this.securityService.IsAuthorized&&this._router.navigate(["authorized"])}ngOnInit(){window.location.hash&&(this.hash=window.location.hash,this.securityService.AuthorizedCallback())}Login(){console.log("Do login logic"),this.securityService.Authorize()}Logout(){console.log("Do logout logic"),this.securityService.Logoff()}}return(o=n).\u0275fac=function(e){return new(e||o)(t.Y36(m),t.Y36(h.F0))},o.\u0275cmp=t.Xpm({type:o,selectors:[["oauth"]],standalone:!0,features:[t._Bn([m]),t.jDz],decls:22,vars:2,consts:[[1,"container",2,"margin-top","15px"],[1,"navbar","navbar-default"],[1,"container-fluid"],[1,"navbar-header"],["aria-controls","navbar","aria-expanded","false","data-target","#navbar","data-toggle","collapse","type","button",1,"navbar-toggle","collapsed"],[1,"sr-only"],[1,"icon-bar"],["href","/"],[1,"navbar-brand"],["src","/icon.png",1,"icon-banner"],["id","navbar",1,"navbar-collapse","collapse"],[1,"nav","navbar-nav"],[1,"navigationLinkButton",3,"click"],["class","navigationLinkButton",3,"click",4,"ngIf"]],template:function(e,a){1&e&&(t.TgZ(0,"div",0)(1,"nav",1)(2,"div",2)(3,"div",3)(4,"button",4)(5,"span",5),t._uU(6,"Toggle navigation"),t.qZA(),t._UZ(7,"span",6)(8,"span",6)(9,"span",6),t.qZA(),t.TgZ(10,"a",7)(11,"span",8),t._UZ(12,"img",9),t.qZA()()(),t.TgZ(13,"div",10)(14,"ul",11)(15,"li")(16,"a",12),t.NdJ("click",function(){return a.Login()}),t._uU(17,"Login"),t.qZA()(),t.TgZ(18,"li"),t.YNc(19,D,2,0,"a",13),t.qZA()()()()(),t._uU(20),t._UZ(21,"router-outlet"),t.qZA()),2&e&&(t.xp6(19),t.Q6J("ngIf",a.securityService.IsAuthorized),t.xp6(1),t.hij(" ",a.hash," "))},dependencies:[h.Bz,h.lC,f.ez,f.O5],encapsulation:2}),n})(),children:[{path:"home",component:_},{path:"authorized",component:A},{path:"unauthorized",component:C},{path:"**",component:I}]}]}}]);